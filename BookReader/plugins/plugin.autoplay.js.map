{"version":3,"file":"plugins/plugin.autoplay.js","mappings":"mKAYuCA,E,oBAPvCC,EAAOC,OAAOC,WAAWC,eAAgB,CACvCC,sBAAsB,IAMxBF,WAAWG,UAAUC,OAAkBP,EAQpCG,WAAWG,UAAUC,MAPf,SAAUC,GACfR,EAAOS,KAAKC,KAAMF,GAElBE,KAAKC,MAAY,EACjBD,KAAKE,UAAY,KACjBF,KAAKG,UAAY,GACnB,GAMFV,WAAWG,UAAUQ,KAAQ,SAASd,GACpC,OAAO,SAAUQ,GAAS,IAAAO,EAAA,KACxBf,EAAOS,KAAKC,KAAMF,GAEbE,KAAKF,QAAQH,sBAClBK,KAAKM,KAAKb,WAAWc,WAAWC,MAAM,kBAAMH,EAAKI,UAAU,GAC7D,CACF,CAP6B,CAO1BhB,WAAWG,UAAUQ,MAKxBX,WAAWG,UAAUc,uBAA0B,SAASpB,GACtD,OAAO,WAAW,IAAAqB,EAAA,KAGhB,GAFArB,EAAOS,KAAKC,MAEPA,KAAKF,QAAQH,qBAAlB,CAGA,IAAMiB,EAASZ,KAAKa,EAAE,WAAWC,IAAI,yBAErCF,EAAOG,OAAO,SAASC,OAAM,WAE3B,OADAL,EAAKM,cACE,CACT,IAEAL,EAAOG,OAAO,UAAUC,OAAM,WAE5B,OADAL,EAAKM,cACE,CACT,GAb8C,CAchD,CACF,CAnB+C,CAmB5CxB,WAAWG,UAAUc,wBAQxBjB,WAAWG,UAAUqB,WAAa,SAASC,GAAW,IAAAC,EAAA,KACpD,GAAKnB,KAAKF,QAAQH,qBAAlB,CAEA,IAAMG,EAAUe,EAAErB,OAAO,CACvB4B,UAAWpB,KAAKoB,UAChBjB,UAAWH,KAAKG,WACfe,GAEHlB,KAAKoB,UAAyC,iBAAtBtB,EAAQsB,UAAyBtB,EAAQsB,UAAYpB,KAAKoB,UAClFpB,KAAKG,UAAyC,iBAAtBL,EAAQK,UAAyBL,EAAQK,UAAYH,KAAKG,UAClFH,KAAKqB,QAAQ5B,WAAWc,WAAWC,MAEnC,IAAIc,GAAiB,EACjBtB,KAAKuB,cAAgBvB,KAAKwB,OAC5BF,GAAiB,EACjBtB,KAAKyB,WAAWzB,KAAKuB,eAGnB,MAAQvB,KAAKE,WAKV,MAAQF,KAAK0B,iBAAoBJ,GAIpCtB,KAAK2B,KAAK,CAAEC,aAAa,IAG3B5B,KAAKa,EAAE,SAASgB,OAChB7B,KAAKa,EAAE,UAAUiB,OACjB9B,KAAKE,UAAY6B,aAAY,WACvBZ,EAAKa,YAELC,KAAKC,IAAIf,EAAKgB,QAAQC,cAAejB,EAAKgB,QAAQE,gBAAkBlB,EAAKmB,KAAKC,cAAgB,EAChGpB,EAAKqB,KAAK,CAAEZ,aAAa,IAEzBT,EAAKQ,KAAK,CAAEC,aAAa,IAE7B,GAAG5B,KAAKG,YAERH,KAAKS,UAzCuC,CA2ChD,EAKAhB,WAAWG,UAAUa,SAAW,WACzBT,KAAKF,QAAQH,sBAEd,MAAQK,KAAKE,YACfuC,cAAczC,KAAKE,WACnBF,KAAKoB,UAAY,OACjBpB,KAAKa,EAAE,UAAUgB,OACjB7B,KAAKa,EAAE,SAASiB,OAChB9B,KAAKE,UAAY,KAErB,C","sources":["webpack://@internetarchive/bookreader/./src/plugins/plugin.autoplay.js"],"sourcesContent":["/*global BookReader */\n\n/**\n * Plugin which adds an autoplay feature. Useful for kiosk situations.\n */\njQuery.extend(BookReader.defaultOptions, {\n  enableAutoPlayPlugin: true\n});\n\n/**\n * @override BookReader.setup\n */\nBookReader.prototype.setup = (function(super_) {\n  return function (options) {\n    super_.call(this, options);\n\n    this.auto      = false;\n    this.autoTimer = null;\n    this.flipDelay = 5000;\n  };\n})(BookReader.prototype.setup);\n\n/**\n * @override BookReader.init\n */\nBookReader.prototype.init = (function(super_) {\n  return function (options) {\n    super_.call(this, options);\n\n    if (!this.options.enableAutoPlayPlugin) return;\n    this.bind(BookReader.eventNames.stop, () => this.autoStop());\n  };\n})(BookReader.prototype.init);\n\n/**\n * @override BookReader.bindNavigationHandlers\n */\nBookReader.prototype.bindNavigationHandlers = (function(super_) {\n  return function() {\n    super_.call(this);\n\n    if (!this.options.enableAutoPlayPlugin) return;\n\n    // Note the mobile plugin attaches itself to body, so we need to select outside\n    const jIcons = this.$('.BRicon').add('.BRmobileMenu .BRicon');\n\n    jIcons.filter('.play').click(() => {\n      this.autoToggle();\n      return false;\n    });\n\n    jIcons.filter('.pause').click(() => {\n      this.autoToggle();\n      return false;\n    });\n  };\n})(BookReader.prototype.bindNavigationHandlers);\n\n/**\n * Starts autoplay mode\n * @param {object} overrides\n * @param {number} overrides.flipSpeed\n * @param {number} overrides.flipDelay\n */\nBookReader.prototype.autoToggle = function(overrides) {\n  if (!this.options.enableAutoPlayPlugin) return;\n\n  const options = $.extend({\n    flipSpeed: this.flipSpeed,\n    flipDelay: this.flipDelay\n  }, overrides);\n\n  this.flipSpeed = typeof options.flipSpeed === \"number\" ? options.flipSpeed : this.flipSpeed;\n  this.flipDelay = typeof options.flipDelay === \"number\" ? options.flipDelay : this.flipDelay;\n  this.trigger(BookReader.eventNames.stop);\n\n  let bComingFrom1up = false;\n  if (this.constMode2up != this.mode) {\n    bComingFrom1up = true;\n    this.switchMode(this.constMode2up);\n  }\n\n  if (null == this.autoTimer) {\n    // $$$ Draw events currently cause layout problems when they occur during animation.\n    //     There is a specific problem when changing from 1-up immediately to autoplay in RTL so\n    //     we workaround for now by not triggering immediate animation in that case.\n    //     See https://bugs.launchpad.net/gnubook/+bug/328327\n    if (('rl' == this.pageProgression) && bComingFrom1up) {\n      // don't flip immediately -- wait until timer fires\n    } else {\n      // flip immediately\n      this.next({ triggerStop: false });\n    }\n\n    this.$('.play').hide();\n    this.$('.pause').show();\n    this.autoTimer = setInterval(() => {\n      if (this.animating) return;\n\n      if (Math.max(this.twoPage.currentIndexL, this.twoPage.currentIndexR) >= this.book.getNumLeafs() - 1) {\n        this.prev({ triggerStop: false }); // $$$ really what we want?\n      } else {\n        this.next({ triggerStop: false });\n      }\n    }, this.flipDelay);\n  } else {\n    this.autoStop();\n  }\n};\n\n/**\n * Stop autoplay mode, allowing animations to finish\n */\nBookReader.prototype.autoStop = function() {\n  if (!this.options.enableAutoPlayPlugin) return;\n\n  if (null != this.autoTimer) {\n    clearInterval(this.autoTimer);\n    this.flipSpeed = 'fast';\n    this.$('.pause').hide();\n    this.$('.play').show();\n    this.autoTimer = null;\n  }\n};\n"],"names":["super_","jQuery","extend","BookReader","defaultOptions","enableAutoPlayPlugin","prototype","setup","options","call","this","auto","autoTimer","flipDelay","init","_this","bind","eventNames","stop","autoStop","bindNavigationHandlers","_this2","jIcons","$","add","filter","click","autoToggle","overrides","_this3","flipSpeed","trigger","bComingFrom1up","constMode2up","mode","switchMode","pageProgression","next","triggerStop","hide","show","setInterval","animating","Math","max","twoPage","currentIndexL","currentIndexR","book","getNumLeafs","prev","clearInterval"],"sourceRoot":""}